<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>中興課表（自填／QR 匯入）</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
</head>
<body>
    <header class="topbar">
        <h1>中興課表（自填／QR 匯入）</h1>
        <div class="actions">
            <button id="btnScan" class="btn primary">掃描 QR</button>
            <button id="btnClear" class="btn danger">清空</button>
        </div>
    </header>

    <p class="hint">
        提示：第一次打開會是空白（僅表格）．掃描學校課表 QR 會自動匯入；「清空」會移除本機資料。
    </p>

    <section id="grid" class="grid"></section>

    <!-- 掃描器 Modal -->
    <div id="qrModal" class="modal hidden" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2>掃描 QR Code</h2>
                <button id="btnClose" class="btn ghost">關閉</button>
            </div>

            <div class="camera-wrap">
                <video id="cam" playsinline autoplay muted></video>
                <canvas id="qrCanvas" class="hidden"></canvas>
                <div class="camera-controls">
                    <button id="btnCapture" class="btn primary lg">拍照辨識</button>
                </div>
            </div>

            <div id="qrHint" class="qr-hint">
                相機無法啟用（可能未授權，或非 Safari）。<br />
                請確認：使用 <b>Safari</b> 打開本頁，並已允許相機；<br />
                或直接 <b>上傳含 QR 的圖片</b> 辨識：
                <label class="btn">
                    <input id="fileInput" type="file" accept="image/*" hidden />
                    選擇檔案
                </label>
                <span id="fileName">未選擇任何檔案</span>
            </div>

            <p class="qr-note">
                把 QR 放在畫面中央，對焦後再按「拍照辨識」。若無法啟用相機、會提供「上傳圖片」備援。
            </p>
        </div>
    </div>

    <!-- jsQR（QR 解碼） -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="app.js"></script>

    <script>
        // PWA：註冊 Service Worker（可離線）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js');
            });
        }
    </script>
</body>
</html>
