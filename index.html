<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>中興課表（自填 / QR 匯入）</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0b1623" />

    <style>
        :root {
            --bg: #0b1623;
            --panel: #0f1e2e;
            --grid: #31455e;
            --text: #cfe9ff;
            --muted: #9ab8d6;
            --chip-bg: #134a9f22;
            --chip-border: #2b7cd6;
            --chip-text: #bfe0ff;
        }

        html, body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif
        }

        .wrap {
            max-width: 1040px;
            margin: 28px auto;
            padding: 0 16px
        }

        h1 {
            margin: 0 0 16px;
            font-size: 28px;
            line-height: 1.3
        }

        .toolbar {
            display: flex;
            gap: 12px;
            margin: 6px 0 10px
        }

        button {
            background: #17406e;
            border: 1px solid #2b5b8a;
            color: #e8f3ff;
            border-radius: 12px;
            padding: 10px 18px;
            font-size: 16px;
            cursor: pointer
        }

            button.secondary {
                background: #611f1f;
                border-color: #8a2b2b
            }

        .hint {
            color: var(--muted);
            font-size: 14px;
            margin: 6px 0 16px
        }

        .table-wrap {
            background: var(--panel);
            border-radius: 14px;
            padding: 8px
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0
        }

        th, td {
            border: 1px solid var(--grid)
        }

        th {
            position: sticky;
            top: 0;
            background: #112235;
            z-index: 2
        }

        th, td {
            padding: 14px 12px;
            text-align: center
        }

        td {
            min-height: 84px;
            height: 84px
        }

        thead th {
            font-weight: 700
        }

        tbody td {
            vertical-align: top
        }

        .slot {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center
        }

        .chip {
            border: 1px solid var(--chip-border);
            background: var(--chip-bg);
            color: var(--chip-text);
            padding: 6px 8px;
            border-radius: 10px;
            line-height: 1.25;
            min-width: 120px
        }

        .time-cell {
            white-space: nowrap
        }

        .full-modal {
            position: fixed;
            inset: 0;
            background: #07111bF2;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999
        }

        .sheet {
            width: min(900px,92vw);
            max-height: 92vh;
            background: var(--panel);
            border: 1px solid var(--grid);
            border-radius: 16px;
            padding: 16px 16px 12px;
            box-shadow: 0 12px 40px #0008;
            overflow: auto
        }

            .sheet h2 {
                margin: 0 0 8px;
                font-size: 20px
            }

            .sheet .actions {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                margin-top: 10px
            }

        .btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid var(--grid);
            background: #17314a;
            color: #eaf3ff;
            cursor: pointer
        }

            .btn.warn {
                background: #522020;
                border-color: #7d2b2b
            }

            .btn.primary {
                background: #1b4f91;
                border-color: #296fcd
            }

        .video-ct {
            position: relative;
            aspect-ratio: 3/4;
            background: #000;
            border-radius: 12px;
            overflow: hidden
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        canvas {
            display: none
        }

        pre {
            background: #0b1623;
            border: 1px solid var(--grid);
            border-radius: 10px;
            padding: 12px;
            white-space: pre-wrap;
            word-break: break-word;
            color: #e7f4ff
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h1>中興課表（自填 / QR 匯入）</h1>

        <div class="toolbar">
            <button id="btnScan">掃描 QR</button>
            <button id="btnClear" class="secondary">清空</button>
        </div>
        <div class="hint">提示：第一次打開會是空白（只有格線）。掃描學校 QR 後才會把課程填入；「清空」會刪除本機資料。</div>

        <div class="table-wrap">
            <table id="grid">
                <thead>
                    <tr>
                        <th style="width:110px">時間</th>
                        <th>星期一</th>
                        <th>星期二</th>
                        <th>星期三</th>
                        <th>星期四</th>
                        <th>星期五</th>
                    </tr>
                </thead>
                <tbody id="grid-body"><!-- 由 JS 產生行 --></tbody>
            </table>
        </div>
    </div>

    <!-- 掃描與確認：全螢幕彈窗 -->
    <div id="modal" class="full-modal" aria-hidden="true">
        <div class="sheet" role="dialog" aria-modal="true">
            <h2 id="modalTitle">掃描 QR Code</h2>
            <div id="scanPane">
                <div id="camWrap" class="video-ct"></div>
                <div style="display:flex;gap:10px;margin-top:10px">
                    <button id="btnShoot" class="btn primary">拍照辨識</button>
                    <input id="fileInput" type="file" accept="image/*" class="btn" />
                </div>
            </div>

            <div id="confirmPane" style="display:none">
                <div class="hint">以下為掃描到的內容（已嘗試標準化）。請確認無誤再匯入：</div>
                <pre id="preview"></pre>
                <div class="actions">
                    <button id="btnImport" class="btn primary">匯入</button>
                    <button id="btnBack" class="btn">返回</button>
                </div>
            </div>

            <div class="actions">
                <button id="btnClose" class="btn warn">關閉</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
    <script defer src="app.js"></script>
</body>
</html>
